<!DOCTYPE html>
<html>
<head>
    <title>Library Test - 583 Books</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        .loading { border-left: 4px solid #3b82f6; }
        .category {
            display: inline-block;
            margin: 5px;
            padding: 10px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            font-weight: bold;
        }
        .book {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }
        h1 { color: #1f2937; }
        h2 { color: #374151; margin-top: 30px; }
    </style>
</head>
<body>
    <h1>üîç NARA Library Test</h1>
    <div id="status" class="status loading">
        ‚è≥ Loading books from Firebase Storage...
    </div>

    <div id="results"></div>

    <script>
        const CATALOGUE_URL = 'https://firebasestorage.googleapis.com/v0/b/nara-web-73384.firebasestorage.app/o/public%2Flibrary_catalogue.json?alt=media';

        async function testLibrary() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');

            try {
                statusDiv.innerHTML = '‚è≥ Fetching catalogue from Firebase Storage...';

                const response = await fetch(CATALOGUE_URL);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const books = await response.json();

                // Count by category
                const categories = {};
                books.forEach(book => {
                    const cat = book.material_type_code || 'Unknown';
                    categories[cat] = (categories[cat] || 0) + 1;
                });

                // Success message
                statusDiv.className = 'status success';
                statusDiv.innerHTML = `
                    <h2>‚úÖ SUCCESS!</h2>
                    <p><strong>Total Books:</strong> ${books.length}</p>
                    <p><strong>Categories:</strong> ${Object.keys(categories).length}</p>
                    <p><strong>Source:</strong> Firebase Storage (public JSON)</p>
                `;

                // Show categories
                let html = '<h2>üìö Categories</h2><div>';
                Object.entries(categories)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([cat, count]) => {
                        html += `<span class="category">${cat}: ${count}</span>`;
                    });
                html += '</div>';

                // Show first 5 books
                html += '<h2>üìñ First 5 Books</h2>';
                books.slice(0, 5).forEach(book => {
                    html += `
                        <div class="book">
                            <strong>${book.title}</strong><br>
                            <small>Author: ${book.author || 'Unknown'}</small><br>
                            <small>Category: ${book.material_type_code} - ${book.material_type_name}</small><br>
                            <small>Barcode: ${book.barcode}</small>
                        </div>
                    `;
                });

                resultsDiv.innerHTML = html;

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    <h2>‚ùå ERROR</h2>
                    <p><strong>Message:</strong> ${error.message}</p>
                    <p><strong>This means:</strong> Cannot load books from Firebase Storage</p>
                    <p><strong>URL:</strong> ${CATALOGUE_URL}</p>
                `;
                console.error('Error:', error);
            }
        }

        // Run test on page load
        testLibrary();
    </script>
</body>
</html>
